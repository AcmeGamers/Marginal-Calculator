<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marginal Calculator</title>
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="components/tabs.css" />
  </head>
  <body>
    <div id="tabs">
      <h2>Calculator</h2>

      <div class="tab">
        <button
          class="tablinks"
          onclick="openTab(event, 'Marginal_Revenue_Tab')"
        >
          Marginal Revenue
        </button>
        <button class="tablinks" onclick="openTab(event, 'PED')">
          Price Elasticity of Demand (PED)
        </button>
        <button class="tablinks" onclick="openTab(event, 'YED')">
          Income Elasticity of Demand (YED)
        </button>
        <button class="tablinks" onclick="openTab(event, 'XED')">
          Cross Price Elasticity of Demand (XED)
        </button>
        <button class="tablinks" onclick="openTab(event, 'PC')">
          Percentage Change
        </button>
      </div>

      <!-- Marginal Revenue (MR) -->
      <div id="Marginal_Revenue_Tab" class="tabcontent">
        <div class="text_and_input">
          <p class="margin-right-1rem">Expression</p>
          <input
            type="text"
            value="49 + 8*q + 6*Q^2"
            placeholder="49 + 8*q + 6*Q^2"
            id="expression"
          />
        </div>

        <!-- 55 + 6*q - 7*q^2 + 3*q^3 === Q = 4 === 94 -->
        <div class="text_and_input">
          <p class="margin-right-1rem">Value of Q:</p>
          <input type="text" value="9" placeholder="Value of Q" id="q_value" />
        </div>

        <input
          value="Calculate!"
          style="margin-top: 6px"
          type="button"
          onclick="MRCheck()"
        />

        <div id="mr1" class="left-align">
          <h2 id="derivation_h2"></h2>
          <p id="derivative_step1" class="hide"></p>
          <p id="derivative_step1_2" class="no-margin"></p>
          <p id="derivative_step2" class="hide"></p>
          <p id="derivative_step2_2" class="no-margin"></p>
        </div>

        <div id="mr2" class="left-align">
          <h2 id="puttingValues_h2"></h2>
          <p id="puttingValues_step1" class="hide"></p>
          <p id="puttingValues_step1_1" class="no-margin"></p>
          <p id="puttingValues_step1_2" class="no-margin"></p>
          <p id="puttingValues_step2" class="hide"></p>
          <p id="puttingValues_step2_1" class="no-margin"></p>
          <span id="result"></span>
        </div>

        <div id="mr3" class="left-align">
          <h2 id="Marginal_Conclusion_1"></h2>
          <span id="Marginal_Conclusion_2"></span>
        </div>
      </div>

      <!-- Price Elasticity of Demand (PED) -->
      <div id="PED" class="tabcontent">
        <div>
          <h3>Price Elasticity of Demand (PED)</h3>
          <div id="observe_ped_change">
            <span>Price Goods Limit:</span>
            <input type="radio" value="1" id="ped_1" name="status" />
            <label for="value_1">1</label>
            <input type="radio" value="2" id="ped_2" name="status" />
            <label for="value_2">2</label>
            <input type="radio" value="3" id="ped_3" name="status" />
            <label for="value_1">3</label>
          </div>
          <div>
            <span>Expression </span>
            <input
              type="text"
              style="width: 50vw"
              value="7777 - P1 + 0.75 * P2 - 0.5*p3 + 0.05*y"
              placeholder="1456 - P1 + 0.75 * P2 - 0.5 * p3 + 0.05*Y"
              id="expression"
            />
          </div>

          <!-- "1456 - P1 + 0.75 * P2 - 0.5 * p3 + 0.05*Y" -->
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: flex-start;
            "
          >
            <div id="PED_goods" style="display: block; margin: 1rem 0">
              <span id="ped_result"></span>
            </div>
            <div
              style="display: flex; flex-direction: row; align-items: baseline"
            >
              <p class="margin-right-1rem" style="margin-top: 0">Income (Y)</p>
              <input
                id="income"
                value="18361"
                type="text"
                placeholder="Income"
              />
            </div>

            <input
              style="margin: 1rem 0"
              value="Calculate!"
              type="button"
              onclick="PEDCheck()"
            />
          </div>

          <div id="ped1" class="left-align">
            <h2 id="calculate_h2"></h2>
            <p id="calculate_step1" class="hide"></p>
            <p id="calculate_step1_2" class="no-margin"></p>
            <p id="calculate_step1_3" class="no-margin"></p>
            <p id="calculate_step1_4" class="no-margin"></p>
          </div>
        </div>
      </div>

      <div id="YED" class="tabcontent">
        <h3>YED</h3>
        <p>YED is the capital of Japan.</p>
      </div>

      <div id="XED" class="tabcontent">
        <h3>XED</h3>
        <p>XED is the capital of Japan.</p>
      </div>

      <div id="PC" class="tabcontent">
        <h3>Estimate the Percentage Change</h3>
        <p>PC is the capital of Japan.</p>
      </div>
    </div>
  </body>

  <!-- Nerdamer -->

  <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.12/nerdamer.core.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.12/Algebra.js"
    integrity="sha256-oJEHFFp8pDXx0Myx6cc7RVmh3a2kZPEGOP+bAunJptU="
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.12/Calculus.js"
    integrity="sha256-1X0hl2yReR/yZuZo7R3A9LUgS9+zWl8GzYjuk4pd6bE="
    crossorigin="anonymous"
  ></script>

  <!-- Math JS -->
  <script src="https://cdn.jsdelivr.net/npm/mathjs@10.0.0/lib/browser/math.min.js"></script>

  <!-- Katex -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
    integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs"
    crossorigin="anonymous"
  />

  <!-- The loading of KaTeX is deferred to speed up page rendering -->
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"
    integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx"
    crossorigin="anonymous"
  ></script>

  <!-- To automatically render math in text elements, include the auto-render extension: -->
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js"
    integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"
    crossorigin="anonymous"
    onload="renderMathInElement(document.body);"
  ></script>

  <!-- My Scripts -->
  <script src="altogether.js"></script>
  <script>
    function openTab(evt, cityName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(cityName).style.display = "block";
      evt.currentTarget.className += " active";
    }
  </script>

  <!-- Custom Functions / Scripts  -->
  <script>
    // Add Custom Style Property
    function hideToShow(name, value, repeat) {
      try {
        if (repeat > 0) {
          for (var data = 1; data <= repeat; data++) {
            document.getElementById(name + data).style.display = value;
          }
          console.log("Complete");
        } else {
          log(
            `The repeat is given less than 1, current value of repeat: ${repeat}`
          );
        }
      } catch (error) {
        console.log(`There is some error in the user input`);
      }
    }

    // Marginal Revenue Function
    function MRCheck() {
      hideToShow("mr", "flex", 3);

      // Obtaining Input Value
      var expression = document
        .getElementById("expression")
        .value.toLowerCase()
        .replace(/q/g, "x"); // This line replaces any `x` variable with `q`

      // Logs The Result
      console.log(expression);
      var q_value = document.getElementById("q_value").value; // Gets Value of Q

      // Latex Function
      function LatexValue(id, nerdamerExpression, TheElement, data) {
        // Renders data
        document.getElementById(id).innerHTML = katex.render(
          data +
            `=  ${nerdamer.expressions(true, "LaTeX")[nerdamerExpression]}`,
          document.getElementById(TheElement),
          {
            displayMode: true,
            macros: {
              "\\RR": "\\mathbb{R}",
            },
          }
        );
      }

      // Latex Function Without Nerdamer
      function LatexValue_WithoutNerdamer(
        id,
        expressionValue,
        TheElement,
        data
      ) {
        document.getElementById(id).innerHTML = katex.render(
          data + `=  ${expressionValue}`,
          document.getElementById(TheElement),
          {
            displayMode: true,
            macros: {
              "\\RR": "\\mathbb{R}",
            },
          }
        );
      }

      // Each Value Checker
      function valueCheck(dataExpression) {
        // Split using a space character
        let arr = dataExpression.split(" ");

        // Making the Array
        var value1 = [];
        for (let index = 0; index < arr.length; index++) {
          value1 += `${arr[index]} `;
        }

        // Result
        var finalAnswer = eval(math.evaluate(value1));
        console.log(value1);
        console.log(finalAnswer);

        answers = {
          derivative: deriveExpression(expressionValue),
          puttingValues: value1,
          answer: finalAnswer,
        };
        return answers;
      }

      // Marginal Revenue Calculation
      function MarginalRevenue(expression, Q) {
        // Obtaining the Expression from first Function
        var expressionValue = expression,
          deviationResult = deriveExpression(expressionValue),
          result = deviationResult.replace(/x/g, Q);
        console.log(deviationResult);

        // Split using a space character
        let arr = result.split(" ");

        // Making the Array
        var value1 = [];
        for (let index = 0; index < arr.length; index++) {
          value1 += `${arr[index]} `;
        }

        // Result
        var finalAnswer = eval(math.evaluate(value1));
        console.log(value1);
        console.log(finalAnswer);

        // Providing the answers to variables which needs it.
        answers = {
          derivative: deriveExpression(expressionValue),
          puttingValues: value1,
          answer: finalAnswer,
        };
        console.log("-------------------");
        return answers;
      }

      // Marginal Revenue Function Calculation 2
      function MarginalRevenueDisplay() {
        var result = MarginalRevenue(expression, q_value);

        // Derivation
        document.getElementById("derivation_h2").innerHTML =
          "Step 1: Derivation";

        var element = "derivative_step1_2";
        var firstNearDream = nerdamer(`d/dQ(${expression.replace(/x/g, "Q")})`);
        LatexValue("derivative_step1", "1", element, "MC ");

        element = "derivative_step2_2";
        var secondNearDream = nerdamer(
          `${result.derivative.replace(/x/g, "Q")}`
        );
        LatexValue("derivative_step2", "2", element, "MC ");

        // Putting Values
        document.getElementById("puttingValues_h2").innerHTML =
          "Step 2: Putting Values";

        // puttingValues_step1_2
        element = "puttingValues_step1_1";
        var thirdNearDream = nerdamer(`${q_value}`);
        LatexValue("puttingValues_step1", "3", element, "Value of Q");

        // puttingValues_step1_1
        element = "puttingValues_step1_2";
        var secondNearDream = nerdamer(`${result.derivative}`);
        LatexValue("puttingValues_step1", "2", element, "MC ");

        // puttingValues_step2_1
        element = "puttingValues_step2_1";
        LatexValue_WithoutNerdamer(
          "puttingValues_step2",
          result.puttingValues,
          element,
          `MC `
        );

        // Results
        document.getElementById("result").innerHTML = `MC = ${result.answer}`;

        // Conclusion
        document.getElementById("Marginal_Conclusion_1").innerHTML =
          "Conclusion";
        document.getElementById(
          "Marginal_Conclusion_2"
        ).innerHTML = `Hence the revenue of ${q_value} units is $${result.answer}`;

        nerdamer.flush();
      }
      // Function that displays values on HTML page
      try {
        MarginalRevenueDisplay();
      } catch (error) {
        document.getElementById("result").innerHTML =
          "There is some issue in the formula or the typed data is invalid";
        console.log(error);
      }
    }
  </script>
  <script>
    var result = document.querySelector("#ped_result");
    document
      .querySelector("#observe_ped_change")
      .addEventListener("change", function (e) {
        var target = e.target;
        var data;
        switch (target.value) {
          case "1":
            data = `<div class="text_and_input"><p class="margin-right-1rem">Pay of Goods 1 (P1)</p><input id="pg1"value="209"type="text"placeholder="Price of Good 1"/></div>`;
            break;
          case "2":
            data = `<div class="text_and_input"><p class="margin-right-1rem">Pay of Goods 1 (P1)</p><input id="pg1"value="209"type="text"placeholder="Price of Good 1"/></div><div class="text_and_input"><p class="margin-right-1rem">Pay of Goods 2 (P2)</p><input id="pg2"value="101"type="text"placeholder="Price of Good 2"/></div>`;
            break;
          case "3":
            data = `<div class="text_and_input"><p class="margin-right-1rem">Pay of Goods 1 (P1)</p><input id="pg1"value="209"type="text"placeholder="Price of Good 1"/></div><div class="text_and_input"><p class="margin-right-1rem">Pay of Goods 2 (P2)</p><input id="pg2"value="101"type="text"placeholder="Price of Good 2"/></div><div class="text_and_input"><p class="margin-right-1rem">Pay of Goods 3 (P3)</p><input id="pg3"value="478"type="text"placeholder="Price of Good 3"/></div>`;
            break;
        }
        console.log(e);
        result.innerHTML = data;
      });
  </script>
</html>
